(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-74b07bf6"],{"56f3":function(module,__webpack_exports__,__webpack_require__){"use strict";var core_js_modules_es_array_for_each_js__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("8ddd"),core_js_modules_es_array_for_each_js__WEBPACK_IMPORTED_MODULE_0___default=__webpack_require__.n(core_js_modules_es_array_for_each_js__WEBPACK_IMPORTED_MODULE_0__),core_js_modules_es_object_to_string_js__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("fafd"),core_js_modules_es_object_to_string_js__WEBPACK_IMPORTED_MODULE_1___default=__webpack_require__.n(core_js_modules_es_object_to_string_js__WEBPACK_IMPORTED_MODULE_1__),core_js_modules_web_dom_collections_for_each_js__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("345a"),core_js_modules_web_dom_collections_for_each_js__WEBPACK_IMPORTED_MODULE_2___default=__webpack_require__.n(core_js_modules_web_dom_collections_for_each_js__WEBPACK_IMPORTED_MODULE_2__),core_js_modules_es_function_name_js__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("965d"),core_js_modules_es_function_name_js__WEBPACK_IMPORTED_MODULE_3___default=__webpack_require__.n(core_js_modules_es_function_name_js__WEBPACK_IMPORTED_MODULE_3__),core_js_modules_es_array_push_js__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__("5edb"),core_js_modules_es_array_push_js__WEBPACK_IMPORTED_MODULE_4___default=__webpack_require__.n(core_js_modules_es_array_push_js__WEBPACK_IMPORTED_MODULE_4__),jszip__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__("abd2"),jszip__WEBPACK_IMPORTED_MODULE_5___default=__webpack_require__.n(jszip__WEBPACK_IMPORTED_MODULE_5__),jszip_vendor_FileSaver_js__WEBPACK_IMPORTED_MODULE_6__=__webpack_require__("5286"),jszip_vendor_FileSaver_js__WEBPACK_IMPORTED_MODULE_6___default=__webpack_require__.n(jszip_vendor_FileSaver_js__WEBPACK_IMPORTED_MODULE_6__),_pub_js__WEBPACK_IMPORTED_MODULE_7__=__webpack_require__("f1d7");__webpack_exports__["a"]={components:{},inject:["reload"],data:function(){return{drawer:{show:!1,maskStyle:{backgroundColor:"transparent"}},imgList:[],form:{iconSize:50,globalAlpha:100,type:10,portraitSpacing:20,horizontalSpacing:20,rotateAngle:0,icon:void 0}}},computed:{iconSize:function(){var t={width:this.form.iconSize,height:this.form.iconSize},e=this.form.icon;if(!e)return!1;if(e.width>e.height){var i=e.width/e.height;t.height=t.width/i}else{var _=e.height/e.width;t.width=t.height/_}return t}},watch:{form:{handler:function(){var t=this;this.slDebounce||(this.slDebounce=this.$pub.slPubDebounce((function(){t.imgList.length&&t.form.icon&&t.imgList.forEach((function(e,i){t.renderImg(i,e)}))}))),this.slDebounce()},deep:!0,immediate:!1}},mounted:function(){},methods:{resetPage:function(){this.reload()},handleWaterMarkIconUpload:function(t){var e=this;Object(_pub_js__WEBPACK_IMPORTED_MODULE_7__["b"])(t).then((function(t){e.form.icon=t,e.$refs.iconPrev.src=t.src}))},handleBeforeUpload:function(t){var e=this;return Object(_pub_js__WEBPACK_IMPORTED_MODULE_7__["b"])(t).then((function(i){i.onload=function(){var _={img:i,fileName:t.name,width:i.width,height:i.height};e.imgList.push(_),e.$nextTick((function(){e.renderImg(e.imgList.length-1,_)}))}})),!1},getCanvas:function getCanvas(index){var canvas=eval("this.$refs.refCanvas"+index)[0];return canvas},renderImg:function(t,e){var i=this.getCanvas(t),_=e.width,r=e.height,a=i.getContext("2d");a.clearRect(0,0,_,r),a.globalAlpha=1,a.drawImage(e.img,0,0,_,r),this.renderIcon(a,e)},renderIcon:function(t,e){if(this.form.icon){var i=this.handlePosition(e);t.globalAlpha=this.form.globalAlpha/100,t.translate(i.center.x,i.center.y),t.rotate(Math.PI/180*this.form.rotateAngle);for(var _=0;_<i.points.length;_++){var r=i.points[_];t.drawImage(this.form.icon,r.x,r.y,this.iconSize.width,this.iconSize.height)}t.rotate(Math.PI/180*this.form.rotateAngle*-1),t.translate(-1*i.center.x,-1*i.center.y)}},handlePosition:function(t){var e=[],i=void 0,_=t.width,r=t.height;if(1==this.form.type){i={x:0,y:0};var a={x:this.form.portraitSpacing,y:this.form.horizontalSpacing};e.push(a)}if(2==this.form.type){i={x:0,y:r/2};var o={x:this.form.portraitSpacing,y:this.form.horizontalSpacing-this.iconSize.height/2};e.push(o)}if(3==this.form.type){i={x:0,y:r};var s={x:this.form.portraitSpacing,y:-1*(this.form.horizontalSpacing+this.iconSize.height)};e.push(s)}if(4==this.form.type){i={x:_,y:0};var n={x:-1*(this.form.portraitSpacing+this.iconSize.width),y:this.form.horizontalSpacing};e.push(n)}if(5==this.form.type){i={x:_,y:r/2};var c={x:-1*(this.form.portraitSpacing+this.iconSize.width),y:this.form.horizontalSpacing-this.iconSize.height/2};e.push(c)}if(6==this.form.type){i={x:_,y:r};var h={x:-1*(this.form.portraitSpacing+this.iconSize.width),y:-1*(this.form.horizontalSpacing+this.iconSize.height)};e.push(h)}if(7==this.form.type){i={x:_/2,y:0};var l={x:this.form.portraitSpacing-this.iconSize.width/2,y:this.form.horizontalSpacing};e.push(l)}if(8==this.form.type){i={x:_/2,y:r/2};var p={x:this.form.portraitSpacing-this.iconSize.width/2,y:this.form.horizontalSpacing-this.iconSize.height/2};e.push(p)}if(9==this.form.type){i={x:_/2,y:r};var m={x:this.form.portraitSpacing-this.iconSize.width/2,y:-1*(this.form.horizontalSpacing+this.iconSize.height)};e.push(m)}if(10==this.form.type){i={x:_/2,y:r/2};var f=this.iconSize.width+this.form.portraitSpacing,u=this.iconSize.height+this.form.horizontalSpacing,d=Math.sqrt(Math.pow(_,2)+Math.pow(r,2))/2,g=-1*d;while(g<d){var v=-1*d;while(v<d)e.push({x:v,y:g}),v+=f;g+=u}}return{points:e,center:i}},handleExportImage:function(){try{if(!this.imgList.length)throw"请选择需要添加水印的图片";if(!this.form.icon)throw"请选择需要添加的水印图片";this.$Spin.show({render:function(t){return t("div",[t("Icon",{class:"demo-spin-icon-load",props:{type:"ios-loading",size:18}}),t("div","Loading")])}}),this.renderExportImage()}catch(t){this.$Message.warning(t)}},renderExportImage:function(){var t=this,e=new jszip__WEBPACK_IMPORTED_MODULE_5___default.a,i=e.folder("images");this.imgList.forEach((function(_,r){var a=t.getCanvas(r);i.file(_.fileName,a.toDataURL("image/jpeg",1).substring(22),{base64:!0}),r===t.imgList.length-1&&(t.$Spin.hide(),e.generateAsync({type:"blob"}).then((function(t){jszip_vendor_FileSaver_js__WEBPACK_IMPORTED_MODULE_6___default()(t,"watermask.zip")})))}))}}}},"718c":function(t,e,i){"use strict";i("b2b5")},b2b5:function(t,e,i){},fe84:function(t,e,i){"use strict";i.r(e);var _=function(){var t=this,e=t._self._c;return e("div",{staticClass:"fn-main-content"},[e("div",{staticClass:"fn-pub-tool-header-bar"},[e("Upload",{attrs:{multiple:"",format:["jpg","jpeg","png","webp"],action:"",accept:"image","before-upload":t.handleBeforeUpload}},[e("Button",{staticClass:"fn-margin-right-20",attrs:{type:"success"}},[t._v("上传图片")])],1),e("Icon",{attrs:{type:"ios-hammer-outline",size:"26"},on:{click:function(e){t.drawer.show=!0}}})],1),e("div",{staticClass:"fn-layout-main"},t._l(t.imgList,(function(t,i){return e("div",{key:i,staticClass:"img-item",style:{width:t.width+32+"px"}},[e("Card",[e("canvas",{ref:"refCanvas"+i,refInFor:!0,staticClass:"img-canvas",attrs:{width:t.width,height:t.height}})])],1)})),0),e("Drawer",{attrs:{"mask-style":t.drawer.maskStyle,width:300,title:"属性栏",placement:"right"},model:{value:t.drawer.show,callback:function(e){t.$set(t.drawer,"show",e)},expression:"drawer.show"}},[e("div",{staticClass:"option-bar"},[e("Form",{attrs:{"label-width":70}},[e("FormItem",{attrs:{label:"水印图片"}},[e("Upload",{ref:"upload",staticStyle:{display:"inline-block",width:"30px","margin-right":"20px"},attrs:{"show-upload-list":!1,format:["jpg","jpeg","png"],"max-size":2048,type:"drag",action:"","before-upload":t.handleWaterMarkIconUpload}},[e("div",{staticStyle:{width:"30px",height:"30px","line-height":"35px"}},[e("Icon",{attrs:{type:"md-images",size:"20"}})],1)]),e("br"),e("img",{directives:[{name:"show",rawName:"v-show",value:t.form.icon,expression:"form.icon"}],ref:"iconPrev",staticClass:"water-mark-img"})],1),e("FormItem",{attrs:{label:"位置"}},[e("Select",{staticStyle:{width:"200px"},model:{value:t.form.type,callback:function(e){t.$set(t.form,"type",e)},expression:"form.type"}},[e("Option",{attrs:{value:10}},[t._v("铺满")]),e("Option",{attrs:{value:1}},[t._v("左上")]),e("Option",{attrs:{value:2}},[t._v("左中")]),e("Option",{attrs:{value:3}},[t._v("左下")]),e("Option",{attrs:{value:4}},[t._v("右上")]),e("Option",{attrs:{value:5}},[t._v("右中")]),e("Option",{attrs:{value:6}},[t._v("右下")]),e("Option",{attrs:{value:7}},[t._v("中上")]),e("Option",{attrs:{value:8}},[t._v("中间")]),e("Option",{attrs:{value:9}},[t._v("中下")])],1)],1),e("FormItem",{attrs:{label:"水印大小"}},[e("Slider",{attrs:{max:500,min:20,step:5},model:{value:t.form.iconSize,callback:function(e){t.$set(t.form,"iconSize",e)},expression:"form.iconSize"}})],1),e("FormItem",{attrs:{label:"透明度"}},[e("Slider",{attrs:{max:100,min:10},model:{value:t.form.globalAlpha,callback:function(e){t.$set(t.form,"globalAlpha",e)},expression:"form.globalAlpha"}})],1),e("FormItem",{attrs:{label:"上下间距"}},[e("Slider",{attrs:{max:500,min:0},model:{value:t.form.horizontalSpacing,callback:function(e){t.$set(t.form,"horizontalSpacing",e)},expression:"form.horizontalSpacing"}})],1),e("FormItem",{attrs:{label:"左右间距"}},[e("Slider",{attrs:{max:500,min:0},model:{value:t.form.portraitSpacing,callback:function(e){t.$set(t.form,"portraitSpacing",e)},expression:"form.portraitSpacing"}})],1),e("FormItem",{attrs:{label:"旋转角度"}},[e("Slider",{attrs:{max:180,min:-180,step:5},model:{value:t.form.rotateAngle,callback:function(e){t.$set(t.form,"rotateAngle",e)},expression:"form.rotateAngle"}})],1)],1),e("div",[e("Button",{attrs:{type:"primary"},on:{click:t.handleExportImage}},[t._v("导出图片")])],1)],1)])],1)},r=[],a=i("56f3"),o=a["a"],s=(i("718c"),i("e607")),n=Object(s["a"])(o,_,r,!1,null,null,null);e["default"]=n.exports}}]);